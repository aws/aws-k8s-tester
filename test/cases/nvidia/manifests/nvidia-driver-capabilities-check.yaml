apiVersion: v1
kind: Pod
metadata:
  name: moderngl-pod
spec:
  tolerations:
  - key: "nvidia.com/gpu"
    operator: "Exists"
    effect: "NoSchedule"
  containers:
  - name: moderngl-container
    env:
    - name: NVIDIA_DRIVER_CAPABILITIES
      value: "all"
    image: ubuntu:22.04
    command: ["/bin/bash"]
    args:
      - -c
      - |
        set -o errexit
        set -o pipefail

        apt-get update
        
        apt-get install -y \
          python3 \
          python3-pip \
          libgl1-mesa-glx \
          libegl1-mesa \
          libgles2-mesa \
          mesa-utils \
          xvfb
        pip3 install moderngl
        
        sleep 3600
    resources:
      requests:
        memory: "50Gi"
        cpu: "15"
        "nvidia.com/gpu": "1"
      limits:
        memory: "50Gi"
        "nvidia.com/gpu": "1"
  restartPolicy: Never